<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>requestIdleCallback</title>
</head>
<style>
#status {
    margin: 20px 0;
}
#progress {
    width: 100%;
    height: 20px;
    border: 1px solid #ccc;
}
#bar {
height: 100%;
width: 0%;
background-color: #4CAF50;
transition: width 0.5s ;
}
button{
    padding: 10px;
    margin: 10px 0;
}

</style>
<body>
    <p>requestIdleCallback 是浏览器提供的用于在主线程空闲时执行低优先级任务的API，有助于优化性能和响应性。</p>
<div id="controls">
    <button id="startBtn">开始处理10000个数据项</button>
    <button id="animateBtn">动画，开！</button>
</div>
<div id="status">准备就绪</div>
<div id="progress">
    <div id="bar"></div>
</div>

<script>
    const statusEl = document.getElementById('status');
    const progressBar = document.getElementById('bar');
    const startBtn = document.getElementById('startBtn');
    const animateBtn = document.getElementById('animateBtn');
   let dataItems=[]
   for (let i = 0; i < 10000; i++) {
      dataItems.push({
        id:1,
        value:Math.random()*100
      })
   }
   //分批执行，unit单位时间，单位任务
   // idle 一下
    let processing=0
    let isProcessing=false;//是否正在处理
    let startTime
    startBtn.addEventListener('click',()=>{
       if(!isProcessing){
          isProcessing=true;//防止多次点击
          processItems=0//已经处理的条目数
          //性能优化api 统计时长,y用于页面性能的衡量
          startTime=performance.now()
          statusEl.textContent='处理中...'
          //如果没有其他任务，开局即空闲
          //低姿态
          requestIdleCallback(processDataChunk,{
            timeout:3000

          })
          function processDataChunk(deadline){
             console.log(deadline)
             while(dataIdile.timeRemaining()>0&&
             processItems<dataItems.length&&
             isProcessing)
             peocessItem(dataItems[processItems])
             //标记下一次任务开始的狄梵
             
             processedItems++
             {
                

                //模拟处理
                processing++
                processItems++
                //更新进度条
                progressBar.style.width=`${(processItems/dataItems.length)*100}%`
             }
          }


       }
    })
</script>
</body>
</html>