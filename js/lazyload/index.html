<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图片懒加载</title>
</head>
<style>
    * {
        margin: 0;
        padding: 0;
    }

    .image-item {
        width: 100px;
        height: 100px;
        margin-bottom: 100px;
    }

    body {
        background-color: #000;
    }
</style>

<body>
    <img class="image-item" lazyload="true" src="../../image/ee58485192b98775f8be54bab191c5d6_8416893113397816846.gif"
        data-original="https://img.36krcdn.com/hsossms/20250313/v2_15ad8ef9eca34830b4a2e081bbc7f57a@000000_oswg172644oswg1536oswg722_img_000?x-oss-process=image/resize,m_mfit,w_960,h_400,limit_0/crop,w_960,h_400,g_center" />
    <img class="image-item" lazyload="true" src="../../image//fe9036c4c7b04fa4695979610fb8754a_5288865507127771927.gif"
        data-original="https://img.36krcdn.com/hsossms/20250312/v2_aeaa7a1d51e74c3a8f909c96cd73a687@000000_oswg169950oswg1440oswg600_img_jpeg?x-oss-process=image/format,webp" />
    <script>
        const viewHeight = document.documentElement.clientHeight;
        console.log(viewHeight);
        const eles = document.querySelectorAll('img[data-original][lazyload]');
        console.log(eles);//eles是一个伪数组
        window.lazyload = function () {
            Array.prototype.forEach.call(eles, function (item, index) {
                console.log(item);
                //没有值，退出data-original item.dataset.original
                if (item.dataset.original === "") return;
                //img 标签对象在可视区中的位置
                let rect = item.getBoundingClientRect();//获取元素的位置信息
                console.log(rect);
                if (rect.bottom >= 0 && rect.top <= viewHeight) {
                    // 有必要渲染
                    (function () {//闭包,专门做图片的加载
                        var img = new Image(); //我们使用内存中的img对象
                        /*  document.body.appendChild(img); */
                        img.src = item.dataset.original;
                        img.onload = function () {
                            // 图片加载完成
                            // cache 缓存，一次性加载出整个图片
                            // 异步加载
                            item.src = item.dataset.original; //如果图片太大，网速慢，图片会从上到下慢慢画出来
                            item.removeAttribute('data-original');//移除 实现垃圾回收，不用再迭代item
                            item.removeAttribute('lazyload');
                        }
                    })()
                }
            })
        }
        window.removeEventListener('scroll', lazyload);
        document.addEventListener('DOMContentLoaded', lazyload);
        window.addEventListener('scroll', lozyload)
    </script>
</body>

</html>